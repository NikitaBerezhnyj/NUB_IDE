"use client";
import{jsx as e,jsxs as t}from"react/jsx-runtime";import{useLayoutEffect as n,useEffect as o,useRef as r,memo as i,useState as l,useImperativeHandle as s,useMemo as u,forwardRef as c,useCallback as d}from"react";function a(e,t,n,o){var r=e.ownerDocument;o||(o=r.createRange());let i,l,s,u=r.createNodeIterator(e,NodeFilter.SHOW_TEXT,null,!1),c={},d={};for(;i=u.nextNode();)l=i.nodeValue,s=l.length,!c.node&&s>t&&(c.node=i,c.offset=t),!d.node&&s>=n&&(d.node=i,d.offset=n),t-=s,n-=s;return c.node&&o.setStart(c.node,c.offset),d.node&&o.setEnd(d.node,d.offset),o}const p="current",h=e("span",{style:{color:"transparent"},children:"â€‹"}),f=["direction","padding","paddingTop","paddingBottom","paddingLeft","paddingRight","margin","marginTop","marginBottom","marginLeft","marginRight","border","borderWidth","borderTopWidth","borderBottomWidth","borderLeftWidth","borderRightWidth","borderStyle","borderTopStyle","borderBottomStyle","borderLeftStyle","borderRightStyle","fontSize","fontFamily","fontStyle","fontVariant","fontWeight","fontStretch","fontSizeAdjust","textAlign","textTransform","textIndent","letterSpacing","wordSpacing","lineHeight","whiteSpace","wordBreak","overflowWrap","tabSize","MozTabSize"],g=(e,t)=>e.getPropertyValue(t),b=(e,t,n)=>{e.setProperty(t,n)},m=(e,t)=>{const n=g(e,t);return n?parseInt(n,10):0},v=e=>getComputedStyle(e),S=e=>"string"==typeof e&&e.endsWith("%"),y=e=>m(e,"padding-top")+m(e,"padding-bottom")+m(e,"border-top")+m(e,"border-bottom"),x=e=>m(e,"padding-left")+m(e,"padding-right")+m(e,"border-left")+m(e,"border-right"),w=(e,t,n)=>{const o="pointer-events",r=e.style,i=t.style,l=g(r,o),s=g(i,o);b(r,o,"none"),b(i,o,"auto");const u=document.elementFromPoint(n.clientX,n.clientY);return b(r,o,l),b(i,o,s),_(u,t)?u:null},_=(e,t)=>!!e&&t!==e&&t.contains(e),M=(e,t,n)=>{e.dispatchEvent(new MouseEvent(t,n))},k=(e,t)=>{M(e,t.type,t)},z=(e,t)=>{e&&M(e,"mouseout",t)},T=e=>{e.stopPropagation()},C=(e,t,n,o)=>{const r=v(e),i=e.style,l=t.style;n[p]||(n[p]=g(r,"color")),f.forEach((e=>{l[e]=r[e]})),i.color=l.borderColor="transparent",i.caretColor=(null==o?void 0:o.caretColor)||n[p]},E=(e,t,n)=>(e.addEventListener(t,n),()=>{e.removeEventListener(t,n)}),A=(e,t)=>{let n,o=[null,null];const r={t(){setTimeout((()=>{t((()=>{const e=r.o(),t=r.i();return o[0]===e&&o[1]===t||(o=[e,t]),o})())}))},l(e){n=e},o(){const t=e[p];if(!t)return 0;const o=t.selectionStart;return n?Math.min(o,t.selectionEnd-n.data.length):o},i(){const t=e[p];if(!t)return 0;const o=t.selectionEnd;return n?Math.min(o,t.selectionStart+n.data.length):o}};return r},W="undefined"!=typeof window?n:o,R=e=>{const t=r();return t[p]||(t[p]=e())},j=(e,t,n,o,r)=>{let i=null;const l=new ResizeObserver((([t])=>{const{contentRect:{width:n,height:r},borderBoxSize:i}=t;if(i&&i[0])return void o([n,r,i[0].inlineSize-n,i[0].blockSize-r]);const l=v(e);o([n,r,x(l),y(l)])})),s=E(e,"focus",(()=>{r(!0)})),u=E(e,"blur",(()=>{r(!1)})),c=E(e,"scroll",(()=>{const{scrollTop:n,scrollLeft:o}=e;t.style.transform=`translate(${-o}px, ${-n}px)`})),d=E(e,"mousedown",(o=>{n.t();const r=E(document,"mouseup",(()=>{n.t(),r()})),i=w(e,t,o);i&&k(i,o)})),a=E(e,"mouseup",(n=>{const o=w(e,t,n);o&&k(o,n)})),p=E(e,"mousemove",(n=>{const o=w(e,t,n);((e,t,n)=>{e&&k(e,n),t!==e&&(z(t,n),e&&M(e,"mouseover",n))})(o,i,n),i=o})),h=E(e,"mouseleave",(e=>{z(i,e),i=null})),f=E(e,"click",(n=>{const o=w(e,t,n);o&&k(o,n)})),g=E(e,"input",(()=>{n.t()})),b=E(e,"compositionstart",(e=>{n.l(e)})),m=E(e,"compositionupdate",(e=>{n.l(e)})),S=E(e,"compositionend",(()=>{n.l()}));return l.observe(e),()=>{s(),u(),c(),d(),a(),p(),h(),f(),g(),b(),m(),S(),l.disconnect()}},B=/*#__PURE__*/i((({u:e,p:n,h:o,g:r})=>{const[i,c]=l("");return s(n,(()=>c),[]),t("div",{ref:e,"aria-hidden":!0,style:u((()=>({width:r,transform:"translate(0px, 0px)",pointerEvents:"none",userSelect:"none",msUserSelect:"none",WebkitUserSelect:"none",boxSizing:"content-box",textSizeAdjust:"100%",WebkitTextSizeAdjust:"100%",MozTextSizeAdjust:"100%"})),[r]),onClick:T,onMouseDown:T,onMouseUp:T,onMouseOver:T,onMouseOut:T,onMouseMove:T,children:[u((()=>o?o(i):i),[i,o]),h]})})),D=/*#__PURE__*/c((({children:n,autoHeight:i,style:c,onChange:h,onKeyDown:f,onSelectionChange:g,...b},m)=>{const v=r(null),y=r(null),x=r(null),[[w,_,M,k],z]=l([0,0,0,0]),[T,E]=l(!1),D=r(""),[[L,U],O]=l([null,null]),K=R((()=>A(v,O))),$=w+M,H=_+k,I=!!($+H);return s(m,(()=>{const e=v[p],t={get selectionStart(){return K.o()},get selectionEnd(){return K.i()},setRangeText(t,n,o,r){e.setRangeText?e.setRangeText(t,n,o,r):(e.focus(),e.selectionStart=n,e.selectionEnd=o,document.execCommand("insertText",!1,t)),e.dispatchEvent(new Event("input",{bubbles:!0}))}};return new Proxy(e,{get(e,n){if(t[n])return t[n];const o=e[n];return"function"==typeof o?o.bind(e):o},set:(e,t,n)=>(e[t]=n,!0)})}),[]),W((()=>{const e=v[p],t=y[p];if(e&&t)return j(e,t,K,z,E)}),[]),W((()=>{const e=v[p];e&&x[p](e.value)}),[b.value]),W((()=>{const e=v[p],t=y[p];t&&e&&C(e,t,D,c)}),[c]),o((()=>{if(null!=L&&null!=U&&g)if(T){const e=a(y[p],L,L+1).getBoundingClientRect();g({focused:!0,top:e.top,left:e.left,height:e.height,selectionStart:L,selectionEnd:U})}else g({focused:!1,selectionStart:L,selectionEnd:U})}),[T,L,U]),o((()=>{const e=v[p];i&&e&&(e.style.height="auto",e.style.height=e.scrollHeight+"px")})),t("div",{style:u((()=>{let e=$,t=H;return c&&(S(c.width)&&(e=c.width),S(c.height)&&(t=c.height)),{display:"inline-block",position:"relative",width:e,height:t}}),[$,H,c]),children:[e("div",{style:u((()=>{const e={position:"absolute",overflow:"hidden",top:0,left:0,width:$,height:H};return c?(["background","backgroundColor"].forEach((t=>{c[t]&&(e[t]=c[t])})),e):e}),[$,H,c]),children:e(B,{u:y,p:x,h:n,g:w})}),e("textarea",{...b,ref:v,style:u((()=>({...c,background:"transparent",margin:0,position:"absolute",...!I&&{position:void 0,verticalAlign:"top"}})),[c,I]),onChange:d((e=>{var t;null===(t=x[p])||void 0===t||t.call(x,e.target.value),null==h||h(e)}),[h]),onKeyDown:d((e=>{e.nativeEvent.isComposing||229===e.nativeEvent.keyCode||(null==f||f(e),K.t())}),[f])})]})})),L=/*#__PURE__*/i((({u:n,p:o,h:r,m:i})=>{const[c,d]=l("");return s(o,(()=>d),[]),e("div",{ref:n,"aria-hidden":!0,onClick:T,onMouseDown:T,onMouseUp:T,onMouseOver:T,onMouseOut:T,onMouseMove:T,children:e("div",{style:{height:i},children:t("div",{style:u((()=>({transform:"translate(0px, 0px)",pointerEvents:"none",userSelect:"none",msUserSelect:"none",WebkitUserSelect:"none",boxSizing:"content-box",textSizeAdjust:"100%",WebkitTextSizeAdjust:"100%",MozTextSizeAdjust:"100%",whiteSpace:"pre"})),[]),children:[u((()=>r?r(c):c),[c,r]),h]})})})})),U=/*#__PURE__*/c((({children:n,autoHeight:i,style:c,onChange:h,onKeyDown:f,onSelectionChange:g,...b},m)=>{const v=r(null),y=r(null),x=r(null),[[w,_,M,k],z]=l([0,0,0,0]),[T,E]=l(!1),B=r(""),[[D,U],O]=l([null,null]),K=R((()=>{const e=(()=>{if("undefined"==typeof navigator)return!1;const e=navigator.userAgent.toLowerCase();return e.indexOf("safari")>-1&&e.indexOf("chrome")<=-1})();return A(v,(t=>{if(O(t),e){if(!v[p]||!y[p])return;const{scrollTop:e,scrollLeft:t}=v[p];y[p].style.transform=`translate(${-t}px, ${-e}px)`}}))})),$=w+M,H=_+k,I=!!($+H);return s(m,(()=>{const e=v[p],t={get selectionStart(){return K.o()},get selectionEnd(){return K.i()},setRangeText(t,n,o,r){e.setRangeText?e.setRangeText(t,n,o,r):(e.focus(),e.selectionStart=n,e.selectionEnd=o,document.execCommand("insertText",!1,t)),e.dispatchEvent(new Event("input",{bubbles:!0}))}};return new Proxy(e,{get(e,n){if(t[n])return t[n];const o=e[n];return"function"==typeof o?o.bind(e):o},set:(e,t,n)=>(e[t]=n,!0)})}),[]),W((()=>{const e=v[p],t=y[p];if(e&&t)return j(e,t,K,z,E)}),[]),W((()=>{const e=v[p];e&&x[p](e.value)}),[b.value]),W((()=>{const e=v[p],t=y[p];t&&e&&C(e,t,B,c)}),[c]),o((()=>{if(null!=D&&null!=U&&g)if(T){const e=a(y[p],D,D+1).getBoundingClientRect();g({focused:!0,top:e.top,left:e.left,height:e.height,selectionStart:D,selectionEnd:U})}else g({focused:!1,selectionStart:D,selectionEnd:U})}),[T,D,U]),o((()=>{const e=v[p];i&&e&&(e.style.height="auto",e.style.height=e.scrollHeight+"px")})),t("div",{style:u((()=>{let e=$,t=H;return c&&(S(c.width)&&(e=c.width),S(c.height)&&(t=c.height)),{display:"inline-block",position:"relative",width:e,height:t}}),[$,H,c]),children:[e("div",{style:u((()=>{const e={position:"absolute",overflow:"hidden",top:0,left:0,width:$,height:H};return c?(["background","backgroundColor"].forEach((t=>{c[t]&&(e[t]=c[t])})),e):e}),[$,H,c]),children:e(L,{u:y,p:x,h:n,m:_})}),e("input",{...b,ref:v,style:u((()=>({...c,background:"transparent",margin:0,position:"absolute",...!I&&{position:void 0,verticalAlign:"top"}})),[c,I]),onChange:d((e=>{var t;null===(t=x[p])||void 0===t||t.call(x,e.target.value),null==h||h(e)}),[h]),onKeyDown:d((e=>{e.nativeEvent.isComposing||229===e.nativeEvent.keyCode||(null==f||f(e),K.t())}),[f])})]})})),O=t=>{const n=t.map((([,e])=>e));return o=>{var r;const[i,l,s]=t.reduce(((e,[t,n])=>(((e,t)=>{const n=[];let o=null;for(;o=e.exec(t);)n.push(o);return n})(t,o).forEach((t=>{const o=t.index,r=t.index+t[0].length;e[0].add(o).add(r);let i=e[1].get(o),l=e[2].get(r);i||e[1].set(o,i=[]),l||e[2].set(r,l=[]),i.push(n),l.push(n)})),e)),[new Set,new Map,new Map]),u=Array.from(i);u.sort(((e,t)=>e-t));let c=0;const d=[],a=[];for(let t=0;t<u.length;t++){const i=u[t],p=null!==(r=u[t+1])&&void 0!==r?r:o.length;if(i===p)continue;const h=o.slice(c,i);h&&a.push(h);const f=l.get(i),g=s.get(p);f&&(f.forEach((e=>{d.push(e)})),d.sort(((e,t)=>n.indexOf(t)-n.indexOf(e))));const b=o.slice(i,p);a.push(d.reduceRight(((t,n,o)=>{const r=0===o?i+"":void 0;return"function"==typeof n?n({children:t,value:b,key:r}):e("span",{style:n,children:t},r)}),b)),g&&g.forEach((e=>{d.splice(d.indexOf(e),1)})),c=p}const p=o.slice(c);return p&&a.push(p),a}};export{D as RichTextarea,O as createRegexRenderer,U as experimental_RichInput};
//# sourceMappingURL=index.mjs.map
